## GCP initial setup

\*([Video source](https://www.youtube.com/watch?v=Hajwnmj0xfQ&list=PL3MmuxUbc_hJed7dXYoJw8DoCuVHhGEQb&index=6))*

GCP is organized around  *projects* . You may create a project and access all available GCP resources and services from the project dashboard.

We will now create a project and a  *service account* , and we will download the authentication keys to our computer. A *service account* is like a user account but for apps and workloads; you may authorize or limit what resources are available to your apps with service accounts.

> You can jump to the [next section](https://github.com/ziritrion/dataeng-zoomcamp/blob/main/notes/1_intro.md#gcp-setup-for-access) if you already know how to do this.

Please follow these steps:

1. Create an account on GCP. You should receive $300 in credit when signing up on GCP for the first time with an account.
2. Setup a new project and write down the Project ID.
   1. From the GCP Dashboard, click on the drop down menu next to the *Google Cloud Platform* title to show the project list and click on  *New project* .
   2. Give the project a name. We will use `dtc-de` in this example. You can use the autogenerated Project ID (this ID must be unique to all of GCP, not just your account). Leave the organization as  *No organization* . Click on  *Create* .
   3. Back on the dashboard, make sure that your project is selected. Click on the previous drop down menu to select it otherwise.
3. Setup a service account for this project and download the JSON authentication key files.
   1. *IAM & Admin* > *Service accounts* > *Create service account*
   2. Provide a service account name. We will use `dtc-de-user`. Leave all other fields with the default values. Click on  *Create and continue* .
   3. Grant the Viewer role (*Basic* >  *Viewer* ) to the service account and click on *Continue*
   4. There is no need to grant users access to this service account at the moment. Click on  *Done* .
   5. With the service account created, click on the 3 dots below *Actions* and select  *Manage keys* .
   6. *Add key* >  *Create new key* . Select *JSON* and click  *Create* . The files will be downloaded to your computer. Save them to a folder and write down the path.
4. Download the [GCP SDK](https://cloud.google.com/sdk/docs/quickstart) for local setup. Follow the instructions to install and connect to your account and project.
5. Set the environment variable to point to the auth keys.
   1. The environment variable name is `GOOGLE_APPLICATION_CREDENTIALS`
   2. The value for the variable is the path to the json authentication file you downloaded previously.
   3. Check how to assign environment variables in your system and shell. In bash, the command should be:
      ```shell
      export GOOGLE_APPLICATION_CREDENTIALS="<path/to/authkeys>.json"
      ```
   4. Refresh the token and verify the authentication with the GCP SDK:
      ```shell
      gcloud auth application-default login
      ```

You should now be ready to work with GCP.


## GCP setup for access

*([Video source](https://www.youtube.com/watch?v=Hajwnmj0xfQ&list=PL3MmuxUbc_hJed7dXYoJw8DoCuVHhGEQb&index=6))*

In the following chapters we will setup a *Data Lake* on Google Cloud Storage and a *Data Warehouse* in BigQuery. We will explore these concepts in future lessons but a Data Lake is where we would usually store data and a Data Warehouse provides a more structured way to access this data.

We need to setup access first by assigning the Storage Admin, Storage Object Admin, BigQuery Admin and Viewer IAM roles to the Service Account, and then enable the `iam` and `iamcredentials` APIs for our project.

Please follow these steps:

1. Assign the following IAM Roles to the Service Account: Storage Admin, Storage Object Admin, BigQuery Admin and Viewer.
   1. On the GCP Project dashboard, go to *IAM & Admin* > *IAM*
   2. Select the previously created Service Account and edit the permissions by clicking on the pencil shaped icon on the left.
   3. Add the following roles and click on *Save* afterwards:
      * `Storage Admin`: for creating and managing  *buckets* .
      * `Storage Object Admin`: for creating and managing *objects* within the buckets.
      * `BigQuery Admin`: for managing BigQuery resources and data.
      * `Viewer` should already be present as a role.
2. Enable APIs for the project (these are needed so that Terraform can interact with GCP):
   * [https://console.cloud.google.com/apis/library/iam.googleapis.com](https://console.cloud.google.com/apis/library/iam.googleapis.com)
   * [https://console.cloud.google.com/apis/library/iamcredentials.googleapis.com](https://console.cloud.google.com/apis/library/iamcredentials.googleapis.com)
3. Make sure that the `GOOGLE_APPLICATION_CREDENTIALS` environment variable is set.
